package adapter.service;

import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import org.mockito.InjectMocks;
import org.mockito.MockitoAnnotations;
import org.junit.Assert;

public class DebeziumProcessorTest {

	JSONObject createPayload;
	JSONObject createResult;
	JSONObject updatePayload;
	JSONObject updateResult;
	JSONObject deletePayload;
	JSONObject deleteResult;
	JSONParser parser = new JSONParser();
	@InjectMocks
	private DebeziumProcessor processor;

	/*
	 * Method to convert String Payload to JSON. Payload format here is the outcome
	 * of Debezium message
	 */
	private JSONObject convertJSON(String payload) throws ParseException {
		JSONObject rawJson = (JSONObject) parser.parse(payload);
		String rawJsonStr = rawJson.toJSONString();
		rawJsonStr.replace("\\", "");
		JSONObject finalPayload = (JSONObject) parser.parse(rawJsonStr);
		return finalPayload;
	}

	@Before
	public void setUp() throws ParseException {
		MockitoAnnotations.initMocks(this);
		String payload;

		payload = "{\"before\":null,\"after\":{\"id\":\"house2:smartrooms:room1\",\"type\":\"urn:mytypes:room\",\"data\":\"{\\\"@id\\\":\\\"house2:smartrooms:room1\\\",\\\"@type\\\":[\\\"urn:mytypes:room\\\"],\\\"myuniqueuri:isPartOf\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T02:11:05.988885Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartcity:houses:house2\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T02:11:05.988885Z\\\"}]}],\\\"myuniqueuri:temperature\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Property\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasValue\\\":[{\\\"@value\\\":23}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/unitCode\\\":[{\\\"@value\\\":\\\"CEL\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T02:11:05.988885Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T02:11:05.988885Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/providedBy\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T02:11:05.988885Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartbuilding:house2:sensor0815\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T02:11:05.988885Z\\\"}]}]}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T02:11:05.988885Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T02:11:05.988885Z\\\"}]}\",\"context\":\"[{\\\"Room\\\":\\\"urn:mytypes:room\\\",\\\"isPartOf\\\":\\\"myuniqueuri:isPartOf\\\",\\\"temperature\\\":\\\"myuniqueuri:temperature\\\"},\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/v1\\/ngsi-ld-core-context.jsonld\\\"]\",\"createdat\":1637633465988885,\"modifiedat\":1637633465988885,\"location\":null,\"observationspace\":null,\"operationspace\":null,\"data_without_sysattrs\":\"{\\\"@id\\\":\\\"house2:smartrooms:room1\\\",\\\"@type\\\":[\\\"urn:mytypes:room\\\"],\\\"myuniqueuri:isPartOf\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartcity:houses:house2\\\"}]}],\\\"myuniqueuri:temperature\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Property\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasValue\\\":[{\\\"@value\\\":23}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/unitCode\\\":[{\\\"@value\\\":\\\"CEL\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/providedBy\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartbuilding:house2:sensor0815\\\"}]}]}]}\",\"kvdata\":\"{\\\"@id\\\":\\\"house2:smartrooms:room1\\\",\\\"@type\\\":[\\\"urn:mytypes:room\\\"],\\\"myuniqueuri:isPartOf\\\":\\\"smartcity:houses:house2\\\",\\\"myuniqueuri:temperature\\\":[{\\\"@value\\\":23}]}\"},\"source\":{\"version\":\"1.7.1.Final\",\"connector\":\"postgresql\",\"name\":\"dbserver1\",\"ts_ms\":1637633466079,\"snapshot\":\"false\",\"db\":\"ngb\",\"sequence\":\"[\\\"32849064\\\",\\\"32877872\\\"]\",\"schema\":\"public\",\"table\":\"entity\",\"txId\":566,\"lsn\":32877872,\"xmin\":null},\"op\":\"c\",\"ts_ms\":1637633466444,\"transaction\":null}";
		createPayload = convertJSON(payload);
		payload = "{\"op\":\"c\",\"before\":null,\"after\":{\"temperature\":23,\"id\":\"house2:smartrooms:room1\",\"type\":\"room\",\"isPartOf\":\"smartcity:houses:house2\",\"@context\":[{\"temperature\":\"myuniqueuri:temperature\",\"isPartOf\":\"myuniqueuri:isPartOf\",\"Room\":\"urn:mytypes:room\"},\"https://uri.etsi.org/ngsi-ld/v1/ngsi-ld-core-context.jsonld\"]},\"source\":{\"version\":\"1.7.1.Final\",\"connector\":\"postgresql\",\"name\":\"dbserver1\",\"ts_ms\":1637633466079,\"snapshot\":\"false\",\"db\":\"ngb\",\"sequence\":\"[\\\"32849064\\\",\\\"32877872\\\"]\",\"schema\":\"public\",\"table\":\"entity\",\"txId\":566,\"lsn\":32877872,\"xmin\":null},\"ts_ms\":1637633466444,\"transaction\":null}";
		createResult = convertJSON(payload);

		payload = "{\"before\":{\"id\":\"house2:smartrooms:room1\",\"type\":\"urn:mytypes:room\",\"data\":\"{\\\"@id\\\":\\\"house2:smartrooms:room1\\\",\\\"@type\\\":[\\\"urn:mytypes:room\\\"],\\\"myuniqueuri:isPartOf\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartcity:houses:house2\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}]}],\\\"myuniqueuri:temperature\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Property\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasValue\\\":[{\\\"@value\\\":23}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/unitCode\\\":[{\\\"@value\\\":\\\"CEL\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/providedBy\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartbuilding:house2:sensor0815\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}]}]}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}]}\",\"context\":\"[{\\\"Room\\\":\\\"urn:mytypes:room\\\",\\\"isPartOf\\\":\\\"myuniqueuri:isPartOf\\\",\\\"temperature\\\":\\\"myuniqueuri:temperature\\\"},\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/v1\\/ngsi-ld-core-context.jsonld\\\"]\",\"createdat\":1637671133861512,\"modifiedat\":1637671133861512,\"location\":null,\"observationspace\":null,\"operationspace\":null,\"data_without_sysattrs\":\"{\\\"@id\\\":\\\"house2:smartrooms:room1\\\",\\\"@type\\\":[\\\"urn:mytypes:room\\\"],\\\"myuniqueuri:isPartOf\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartcity:houses:house2\\\"}]}],\\\"myuniqueuri:temperature\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Property\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasValue\\\":[{\\\"@value\\\":23}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/unitCode\\\":[{\\\"@value\\\":\\\"CEL\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/providedBy\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartbuilding:house2:sensor0815\\\"}]}]}]}\",\"kvdata\":\"{\\\"@id\\\":\\\"house2:smartrooms:room1\\\",\\\"@type\\\":[\\\"urn:mytypes:room\\\"],\\\"myuniqueuri:isPartOf\\\":\\\"smartcity:houses:house2\\\",\\\"myuniqueuri:temperature\\\":[{\\\"@value\\\":23}]}\"},\"after\":{\"id\":\"house2:smartrooms:room1\",\"type\":\"urn:mytypes:room\",\"data\":\"{\\\"@id\\\":\\\"house2:smartrooms:room1\\\",\\\"@type\\\":[\\\"urn:mytypes:room\\\"],\\\"myuniqueuri:isPartOf\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartcity:houses:house2\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}]}],\\\"myuniqueuri:temperature\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Property\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasValue\\\":[{\\\"@value\\\":23}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/unitCode\\\":[{\\\"@value\\\":\\\"CEL\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/providedBy\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartbuilding:house2:sensor0815\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}]}]}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:39:36.844085Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/isPartOf\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:39:36.844085Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartcity:houses:house2\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:39:36.844085Z\\\"}]}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/temperature\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Property\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasValue\\\":[{\\\"@value\\\":50}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/unitCode\\\":[{\\\"@value\\\":\\\"CEL\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:39:36.844085Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:39:36.844085Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/providedBy\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:39:36.844085Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartbuilding:house2:sensor0815\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:39:36.844085Z\\\"}]}]}]}\",\"context\":\"[{\\\"Room\\\":\\\"urn:mytypes:room\\\",\\\"isPartOf\\\":\\\"myuniqueuri:isPartOf\\\",\\\"temperature\\\":\\\"myuniqueuri:temperature\\\"},\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/v1\\/ngsi-ld-core-context.jsonld\\\"]\",\"createdat\":1637671133861512,\"modifiedat\":1637671176844085,\"location\":null,\"observationspace\":null,\"operationspace\":null,\"data_without_sysattrs\":\"{\\\"@id\\\":\\\"house2:smartrooms:room1\\\",\\\"@type\\\":[\\\"urn:mytypes:room\\\"],\\\"myuniqueuri:isPartOf\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartcity:houses:house2\\\"}]}],\\\"myuniqueuri:temperature\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Property\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasValue\\\":[{\\\"@value\\\":23}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/unitCode\\\":[{\\\"@value\\\":\\\"CEL\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/providedBy\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartbuilding:house2:sensor0815\\\"}]}]}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/isPartOf\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartcity:houses:house2\\\"}]}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/temperature\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Property\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasValue\\\":[{\\\"@value\\\":50}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/unitCode\\\":[{\\\"@value\\\":\\\"CEL\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/providedBy\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartbuilding:house2:sensor0815\\\"}]}]}]}\",\"kvdata\":\"{\\\"@id\\\":\\\"house2:smartrooms:room1\\\",\\\"@type\\\":[\\\"urn:mytypes:room\\\"],\\\"myuniqueuri:isPartOf\\\":\\\"smartcity:houses:house2\\\",\\\"myuniqueuri:temperature\\\":[{\\\"@value\\\":23}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/isPartOf\\\":\\\"smartcity:houses:house2\\\",\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/temperature\\\":[{\\\"@value\\\":50}]}\"},\"source\":{\"version\":\"1.7.1.Final\",\"connector\":\"postgresql\",\"name\":\"dbserver1\",\"ts_ms\":1637671176851,\"snapshot\":\"false\",\"db\":\"ngb\",\"sequence\":\"[\\\"33125360\\\",\\\"33140736\\\"]\",\"schema\":\"public\",\"table\":\"entity\",\"txId\":577,\"lsn\":33140736,\"xmin\":null},\"op\":\"u\",\"ts_ms\":1637671177308,\"transaction\":null}";
		updatePayload = convertJSON(payload);
		payload = "{\"op\":\"u\",\"before\":{\"temperature\":23,\"id\":\"house2:smartrooms:room1\",\"type\":\"room\",\"isPartOf\":\"smartcity:houses:house2\",\"@context\":[{\"temperature\":\"myuniqueuri:temperature\",\"isPartOf\":\"myuniqueuri:isPartOf\",\"Room\":\"urn:mytypes:room\"},\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/v1\\/ngsi-ld-core-context.jsonld\"]},\"after\":{\"temperature\":50,\"id\":\"house2:smartrooms:room1\",\"type\":\"room\",\"isPartOf\":\"smartcity:houses:house2\",\"@context\":[{\"temperature\":\"myuniqueuri:temperature\",\"isPartOf\":\"myuniqueuri:isPartOf\",\"Room\":\"urn:mytypes:room\"},\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/v1\\/ngsi-ld-core-context.jsonld\"]},\"source\":{\"version\":\"1.7.1.Final\",\"connector\":\"postgresql\",\"name\":\"dbserver1\",\"ts_ms\":1637671176851,\"snapshot\":\"false\",\"db\":\"ngb\",\"sequence\":\"[\\\"33125360\\\",\\\"33140736\\\"]\",\"schema\":\"public\",\"table\":\"entity\",\"txId\":577,\"lsn\":33140736,\"xmin\":null},\"ts_ms\":1637671177308,\"transaction\":null}";
		updateResult = convertJSON(payload);

		payload = "{\"before\":{\"id\":\"house2:smartrooms:room1\",\"type\":\"urn:mytypes:room\",\"data\":\"{\\\"@id\\\":\\\"house2:smartrooms:room1\\\",\\\"@type\\\":[\\\"urn:mytypes:room\\\"],\\\"myuniqueuri:isPartOf\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartcity:houses:house2\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}]}],\\\"myuniqueuri:temperature\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Property\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasValue\\\":[{\\\"@value\\\":23}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/unitCode\\\":[{\\\"@value\\\":\\\"CEL\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/providedBy\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartbuilding:house2:sensor0815\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}]}]}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:38:53.861512Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:39:36.844085Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/isPartOf\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:39:36.844085Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartcity:houses:house2\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:39:36.844085Z\\\"}]}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/temperature\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Property\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasValue\\\":[{\\\"@value\\\":50}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/unitCode\\\":[{\\\"@value\\\":\\\"CEL\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:39:36.844085Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:39:36.844085Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/providedBy\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/createdAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:39:36.844085Z\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartbuilding:house2:sensor0815\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/modifiedAt\\\":[{\\\"@type\\\":\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/DateTime\\\",\\\"@value\\\":\\\"2021-11-23T12:39:36.844085Z\\\"}]}]}]}\",\"context\":\"[{\\\"Room\\\":\\\"urn:mytypes:room\\\",\\\"isPartOf\\\":\\\"myuniqueuri:isPartOf\\\",\\\"temperature\\\":\\\"myuniqueuri:temperature\\\"},\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/v1\\/ngsi-ld-core-context.jsonld\\\"]\",\"createdat\":1637671133861512,\"modifiedat\":1637671176844085,\"location\":null,\"observationspace\":null,\"operationspace\":null,\"data_without_sysattrs\":\"{\\\"@id\\\":\\\"house2:smartrooms:room1\\\",\\\"@type\\\":[\\\"urn:mytypes:room\\\"],\\\"myuniqueuri:isPartOf\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartcity:houses:house2\\\"}]}],\\\"myuniqueuri:temperature\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Property\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasValue\\\":[{\\\"@value\\\":23}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/unitCode\\\":[{\\\"@value\\\":\\\"CEL\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/providedBy\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartbuilding:house2:sensor0815\\\"}]}]}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/isPartOf\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartcity:houses:house2\\\"}]}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/temperature\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Property\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasValue\\\":[{\\\"@value\\\":50}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/unitCode\\\":[{\\\"@value\\\":\\\"CEL\\\"}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/providedBy\\\":[{\\\"@type\\\":[\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/Relationship\\\"],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/hasObject\\\":[{\\\"@id\\\":\\\"smartbuilding:house2:sensor0815\\\"}]}]}]}\",\"kvdata\":\"{\\\"@id\\\":\\\"house2:smartrooms:room1\\\",\\\"@type\\\":[\\\"urn:mytypes:room\\\"],\\\"myuniqueuri:isPartOf\\\":\\\"smartcity:houses:house2\\\",\\\"myuniqueuri:temperature\\\":[{\\\"@value\\\":23}],\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/isPartOf\\\":\\\"smartcity:houses:house2\\\",\\\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/default-context\\/temperature\\\":[{\\\"@value\\\":50}]}\"},\"after\":null,\"source\":{\"version\":\"1.7.1.Final\",\"connector\":\"postgresql\",\"name\":\"dbserver1\",\"ts_ms\":1637671236386,\"snapshot\":\"false\",\"db\":\"ngb\",\"sequence\":\"[\\\"33153392\\\",\\\"33157256\\\"]\",\"schema\":\"public\",\"table\":\"entity\",\"txId\":582,\"lsn\":33157256,\"xmin\":null},\"op\":\"d\",\"ts_ms\":1637671236572,\"transaction\":null}";
		deletePayload = convertJSON(payload);
		payload = "{\"op\":\"d\",\"before\":{\"temperature\":50,\"id\":\"house2:smartrooms:room1\",\"type\":\"room\",\"isPartOf\":\"smartcity:houses:house2\",\"@context\":[{\"temperature\":\"myuniqueuri:temperature\",\"isPartOf\":\"myuniqueuri:isPartOf\",\"Room\":\"urn:mytypes:room\"},\"https:\\/\\/uri.etsi.org\\/ngsi-ld\\/v1\\/ngsi-ld-core-context.jsonld\"]},\"after\":null,\"source\":{\"version\":\"1.7.1.Final\",\"connector\":\"postgresql\",\"name\":\"dbserver1\",\"ts_ms\":1637671236386,\"snapshot\":\"false\",\"db\":\"ngb\",\"sequence\":\"[\\\"33153392\\\",\\\"33157256\\\"]\",\"schema\":\"public\",\"table\":\"entity\",\"txId\":582,\"lsn\":33157256,\"xmin\":null},\"ts_ms\":1637671236572,\"transaction\":null}";
		deleteResult = convertJSON(payload);
	}

	@After
	public void shutdown() {
		createPayload = null;
		createResult = null;
		updatePayload = null;
		updateResult = null;
		deletePayload = null;
		deleteResult = null;
	}

	/*
	 * Testcase to test processor response for create Entity payload.
	 */
	@Test
	public void createEntityTest() {
		try {
			JSONObject response = processor.processDebeziumData(createPayload);
			Assert.assertEquals(response, createResult);
		} catch (Exception e) {
			Assert.fail();
		}
	}

	/*
	 * Testcase to test processor response for update Entity payload.
	 */
	@Test
	public void updateEntityTest() {
		try {
			JSONObject response = processor.processDebeziumData(updatePayload);
			Assert.assertEquals(response, updateResult);
		} catch (Exception e) {
			Assert.fail();
		}
	}

	/*
	 * Testcase to test processor response for delete Entity payload.
	 */
	@Test
	public void deleteEntityTest() {
		try {
			JSONObject response = processor.processDebeziumData(deletePayload);
			Assert.assertEquals(response, deleteResult);
		} catch (Exception e) {
			Assert.fail();
		}
	}
}
